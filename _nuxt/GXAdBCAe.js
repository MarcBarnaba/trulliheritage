import{d as F,J as B,O as M,E as U,r as w,D as j,j as G,f as J,w as K,c as h,o as p,a as t,t as d,u as a,B as m,H as P,P as C,F as N,v as W,l as z,A as Q,K as X,L as Y,b as E,N as Z}from"./nw_6AWgi.js";import{_ as ee}from"./C-LUc93e.js";import{u as te}from"./BlXxpFey.js";import{u as D,q as H,a as se}from"./BDd8L2hZ.js";import{u as oe}from"./DzrFdPVM.js";const ae={class:"container mx-auto py-16 px-4 md:px-8"},ie={class:"flex flex-col lg:flex-row gap-8"},le={class:"w-full lg:w-1/4 bg-white p-6 rounded shadow-md h-fit"},re={class:"text-xl font-semibold mb-4"},ne={class:"space-y-6"},ce={class:"border-b pb-4"},ue={class:"border-b pb-4"},de={class:"border-b pb-4"},fe={for:"adults",class:"block font-medium text-gray-700 mb-1"},me={class:"flex items-center"},pe=["disabled"],be={class:"border-b pb-4"},he={class:"block font-medium text-gray-700 mb-1"},ye={class:"space-y-2 mt-2"},ge={class:"flex items-center"},_e={for:"pool",class:"ml-2 text-gray-700"},ve={class:"flex items-center"},xe={for:"wifi",class:"ml-2 text-gray-700"},ke={class:"flex items-center"},we={for:"ac",class:"ml-2 text-gray-700"},Ce={class:"flex items-center"},qe={for:"pets",class:"ml-2 text-gray-700"},Se={class:"flex gap-2"},Pe={class:"w-full lg:w-3/4"},Ae={key:0,class:"flex justify-center items-center h-64"},$e={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ve={key:2,class:"bg-white p-8 rounded shadow text-center"},Ee={class:"text-xl font-semibold mb-2"},Fe={class:"text-gray-600"},Be=F({__name:"CardsGrid",setup(L){const i=B(),_=M(),{t:n,locale:A}=U(),f=w([]),c=w([]),b=w(!0),y=w(!1),e=j({checkin:"",checkout:"",adults:1,amenities:{pool:!1,wifi:!1,ac:!1,pets:!1}}),g=()=>{i.query.checkin&&(e.checkin=i.query.checkin),i.query.checkout&&(e.checkout=i.query.checkout),i.query.adults&&(e.adults=Number(i.query.adults)),i.query.pool&&(e.amenities.pool=i.query.pool==="true"),i.query.wifi&&(e.amenities.wifi=i.query.wifi==="true"),i.query.ac&&(e.amenities.ac=i.query.ac==="true"),i.query.pets&&(e.amenities.pets=i.query.pets==="true"),i.query.maxPrice&&(e.maxPrice=Number(i.query.maxPrice))},v=async s=>{if(!e.checkin||!e.checkout)return!0;if(!s.slug)return!1;try{const o={checkIn:e.checkin,checkOut:e.checkout,guests:e.adults.toString(),trullo:{slug:s.slug}},{data:r}=await te("/api/checkAvailability",{method:"POST",body:o},"$MGrbSHByWo"),l=r.value;return(l==null?void 0:l.body.available)||!1}catch(o){return console.error(`Errore nel controllo disponibilità per ${s.slug}:`,o),!1}},x=(s,o)=>[...s.services||[],...s.amenities||[]].some(l=>l.icon===o),$=s=>{if(!s.rules||s.rules.length===0)return!1;const o=s.rules.find(r=>r.text.toLowerCase().includes("animal")||r.text.toLowerCase().includes("pets"));return o?o.allowed:!1},k=s=>!(e.adults>(s.maxGuests||0)||e.amenities.pool&&!x(s,"pool")||e.amenities.wifi&&!x(s,"wifi")||e.amenities.ac&&!x(s,"ac_unit")||e.amenities.pets&&!$(s)),q=async()=>{y.value=!0;try{const s=f.value.filter(k);if(e.checkin&&e.checkout){const o=await Promise.all(s.map(async r=>{const l=await v(r);return{structure:r,isAvailable:l}}));c.value=o.filter(r=>r.isAvailable).map(r=>r.structure)}else c.value=s}catch(s){console.error("Errore durante la verifica della disponibilità:",s),c.value=[]}finally{y.value=!1}},V=G(()=>y.value?f.value.filter(k):c.value),O=()=>{e.adults++,u()},R=()=>{e.adults>1&&(e.adults--,u())},T=()=>{e.checkin="",e.checkout="",e.adults=1,e.maxPrice=500,Object.keys(e.amenities).forEach(s=>{e.amenities[s]=!1}),u()},u=()=>{b.value=!0;const s={};e.checkin&&(s.checkin=e.checkin),e.checkout&&(s.checkout=e.checkout),s.adults=e.adults.toString(),e.amenities.pool&&(s.pool="true"),e.amenities.wifi&&(s.wifi="true"),e.amenities.ac&&(s.ac="true"),e.amenities.pets&&(s.pets="true"),e.maxPrice&&e.maxPrice!==500&&(s.maxPrice=e.maxPrice.toString()),_.replace({query:s}),S()},S=async()=>{b.value=!0,c.value=[];try{const{data:s}=await D(`${i.path}-${JSON.stringify(i.query)}`,()=>H(`${A.value}_trulli`).all());f.value=s.value||[],await q()}catch(s){console.error("Errore nel caricamento dei trulli:",s),f.value=[],c.value=[]}finally{b.value=!1}};return J(async()=>{g(),await S()}),K(()=>i.query,()=>{g(),S()},{deep:!0}),(s,o)=>{const r=ee;return p(),h("div",ae,[t("div",ie,[t("div",le,[t("h3",re,d(a(n)("filters")),1),t("div",ne,[t("div",ce,[o[7]||(o[7]=t("label",{for:"checkin",class:"block font-medium text-gray-700 mb-1"},"Check-in",-1)),m(t("input",{type:"date",id:"checkin","onUpdate:modelValue":o[0]||(o[0]=l=>a(e).checkin=l),class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:u},null,544),[[P,a(e).checkin]])]),t("div",ue,[o[8]||(o[8]=t("label",{for:"checkout",class:"block font-medium text-gray-700 mb-1"},"Check-out",-1)),m(t("input",{type:"date",id:"checkout","onUpdate:modelValue":o[1]||(o[1]=l=>a(e).checkout=l),class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:u},null,544),[[P,a(e).checkout]])]),t("div",de,[t("label",fe,d(a(n)("guests")),1),t("div",me,[t("button",{onClick:R,class:"p-2 bg-gray-100 rounded-l border border-gray-300 hover:bg-gray-200",disabled:a(e).adults<=1},o[9]||(o[9]=[t("span",{class:"material-icons text-sm"},"remove",-1)]),8,pe),m(t("input",{type:"number",id:"adults","onUpdate:modelValue":o[2]||(o[2]=l=>a(e).adults=l),min:"1",max:"20",class:"w-full p-2 text-center border-t border-b border-gray-300 focus:outline-none",onChange:u},null,544),[[P,a(e).adults,void 0,{number:!0}]]),t("button",{onClick:O,class:"p-2 bg-gray-100 rounded-r border border-gray-300 hover:bg-gray-200"},o[10]||(o[10]=[t("span",{class:"material-icons text-sm"},"add",-1)]))])]),t("div",be,[t("label",he,d(a(n)("services")),1),t("div",ye,[t("div",ge,[m(t("input",{type:"checkbox",id:"pool","onUpdate:modelValue":o[3]||(o[3]=l=>a(e).amenities.pool=l),onChange:u,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,544),[[C,a(e).amenities.pool]]),t("label",_e,d(a(n)("pool")),1)]),t("div",ve,[m(t("input",{type:"checkbox",id:"wifi","onUpdate:modelValue":o[4]||(o[4]=l=>a(e).amenities.wifi=l),onChange:u,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,544),[[C,a(e).amenities.wifi]]),t("label",xe,d(a(n)("wifi")),1)]),t("div",ke,[m(t("input",{type:"checkbox",id:"ac","onUpdate:modelValue":o[5]||(o[5]=l=>a(e).amenities.ac=l),onChange:u,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,544),[[C,a(e).amenities.ac]]),t("label",we,d(a(n)("airConditioning")),1)]),t("div",Ce,[m(t("input",{type:"checkbox",id:"pets","onUpdate:modelValue":o[6]||(o[6]=l=>a(e).amenities.pets=l),onChange:u,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,544),[[C,a(e).amenities.pets]]),t("label",qe,d(a(n)("animalsAdmitted")),1)])])]),t("div",Se,[t("button",{onClick:T,class:"w-full bg-gray-200 text-gray-700 py-2 px-4 rounded hover:bg-gray-300 transition duration-200"},d(a(n)("reset")),1)])])]),t("div",Pe,[a(b)?(p(),h("div",Ae,o[11]||(o[11]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"},null,-1)]))):a(V).length>0?(p(),h("div",$e,[(p(!0),h(N,null,W(a(V),(l,I)=>(p(),z(r,{key:I,structure:l},null,8,["structure"]))),128))])):(p(),h("div",Ve,[o[12]||(o[12]=t("span",{class:"material-icons text-4xl text-gray-400 mb-4"},"search_off",-1)),t("h3",Ee,d(a(n)("noResult")),1),t("p",Fe,d(a(n)("noResultHelpText")),1)]))])])])}}}),Ue=Q(Be,[["__scopeId","data-v-5d0db66f"]]),Oe=F({__name:"index",async setup(L){var g,v;let i,_;const n=B(),{t:A,locale:f}=U(),{data:c,error:b}=([i,_]=X(()=>D(`${n.path}_page`,()=>H(`${f.value}_pages`).path(`/${f.value}/pages/trulli`).first())),i=await i,_(),i);if(b.value)throw Y({statusCode:500});const{getComponentProps:y}=oe(c.value),e=G(()=>({hero:y("Hero")}));return se({title:(g=c.value)==null?void 0:g.title,description:(v=c.value)==null?void 0:v.description}),(x,$)=>{const k=Z,q=Ue;return p(),h(N,null,[E(k,{"show-travel-bar":a(e).hero.showTravelBar,slim:a(e).hero.slim,title:a(e).hero.title,"img-src":a(e).hero.imgSrc,tagline:a(e).hero.tagline},null,8,["show-travel-bar","slim","title","img-src","tagline"]),E(q)],64)}}});export{Oe as default};
